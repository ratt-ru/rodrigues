db:
  image: postgres:9.3
broker:
  image: dockerfile/rabbitmq
  ports:
    - "5672:5672"
    - "15672:15672"

worker:
 build: django_kat
 command: celery worker -A django_kat -l INFO
 links:
   - broker
   - db
 environment:
   - DJANGO_SETTINGS_MODULE=django_kat.settings.container
   - C_FORCE_ROOT=true
   - SECRET_KEY="doens't matter"
 volumes:
  - /var/run:/var/run
  - /var/lib/docker:/var/lib/docker
  - /results

django:
  build: django_kat
  command: uwsgi --socket django_kat.sock --module django_kat.wsgi --chmod-socket=666
  links:
    - db
    - broker
  environment:
    - DJANGO_SETTINGS_MODULE=django_kat.settings.container
    - SECRET_KEY="please change me"
    - HOSTNAME="192.168.59.103"
    - DEBUG=false
  volumes:
    - /code
  volumes_from:
    - worker

nginx:
  build: nginx
  volumes_from:
    - django
  ports:
    - 80:80

